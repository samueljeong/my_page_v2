{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Step4 Video Assembly Schema",
  "description": "Step4 영상 조립 결과 JSON 스키마",
  "type": "object",
  "required": ["metadata", "timeline", "render_status"],

  "properties": {
    "metadata": {
      "type": "object",
      "required": ["script_id", "total_duration_ms", "resolution"],
      "properties": {
        "script_id": {"type": "string"},
        "total_duration_ms": {"type": "integer"},
        "resolution": {
          "type": "object",
          "properties": {
            "width": {"type": "integer", "default": 1080},
            "height": {"type": "integer", "default": 1920}
          }
        },
        "fps": {"type": "integer", "default": 30},
        "format": {"type": "string", "default": "mp4"},
        "render_engine": {"type": "string", "default": "creatomate"}
      }
    },

    "timeline": {
      "type": "object",
      "required": ["tracks"],
      "properties": {
        "tracks": {
          "type": "object",
          "properties": {
            "video": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["clip_id", "start_ms", "end_ms", "source"],
                "properties": {
                  "clip_id": {"type": "string"},
                  "start_ms": {"type": "integer"},
                  "end_ms": {"type": "integer"},
                  "duration_ms": {"type": "integer"},
                  "source": {
                    "type": "object",
                    "properties": {
                      "type": {"type": "string", "enum": ["image", "video"]},
                      "image_id": {"type": "string"},
                      "url": {"type": "string"},
                      "local_path": {"type": "string"}
                    }
                  },
                  "effects": {
                    "type": "object",
                    "properties": {
                      "ken_burns": {
                        "type": "object",
                        "properties": {
                          "enabled": {"type": "boolean"},
                          "start_scale": {"type": "number"},
                          "end_scale": {"type": "number"},
                          "start_position": {"type": "string"},
                          "end_position": {"type": "string"}
                        }
                      },
                      "transition_in": {
                        "type": "object",
                        "properties": {
                          "type": {"type": "string"},
                          "duration_ms": {"type": "integer"}
                        }
                      },
                      "transition_out": {
                        "type": "object",
                        "properties": {
                          "type": {"type": "string"},
                          "duration_ms": {"type": "integer"}
                        }
                      }
                    }
                  }
                }
              }
            },
            "audio": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["clip_id", "start_ms", "end_ms", "source"],
                "properties": {
                  "clip_id": {"type": "string"},
                  "start_ms": {"type": "integer"},
                  "end_ms": {"type": "integer"},
                  "source": {
                    "type": "object",
                    "properties": {
                      "segment_id": {"type": "string"},
                      "url": {"type": "string"},
                      "local_path": {"type": "string"}
                    }
                  },
                  "volume": {"type": "number", "default": 1.0},
                  "fade_in_ms": {"type": "integer"},
                  "fade_out_ms": {"type": "integer"}
                }
              }
            },
            "subtitle": {
              "type": "object",
              "properties": {
                "enabled": {"type": "boolean", "default": true},
                "srt_source": {"type": "string"},
                "style": {
                  "type": "object",
                  "properties": {
                    "font": {"type": "string"},
                    "size": {"type": "integer"},
                    "color": {"type": "string"},
                    "background": {"type": "string"},
                    "position": {"type": "string"}
                  }
                }
              }
            },
            "background_music": {
              "type": "object",
              "properties": {
                "enabled": {"type": "boolean"},
                "source": {"type": "string"},
                "volume": {"type": "number", "default": 0.1},
                "loop": {"type": "boolean", "default": true}
              }
            }
          }
        }
      }
    },

    "render_status": {
      "type": "object",
      "required": ["status"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["pending", "rendering", "completed", "failed"]
        },
        "progress_percent": {"type": "integer", "minimum": 0, "maximum": 100},
        "render_id": {"type": "string"},
        "started_at": {"type": "string", "format": "date-time"},
        "completed_at": {"type": "string", "format": "date-time"},
        "error": {"type": "string"}
      }
    },

    "output": {
      "type": "object",
      "properties": {
        "video_url": {"type": "string"},
        "local_path": {"type": "string"},
        "file_size": {"type": "integer"},
        "duration_ms": {"type": "integer"},
        "thumbnail_url": {"type": "string"}
      }
    }
  }
}
