"""
three_points.py
3ëŒ€ì§€ ì„¤êµ ìŠ¤íƒ€ì¼ - ì „í†µì ì¸ 3í¬ì¸íŠ¸ ì„¤êµ êµ¬ì¡°

êµ¬ì¡°:
- ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ (ë„ì…ë¶€)
- 1ëŒ€ì§€ (ì²« ë²ˆì§¸ í¬ì¸íŠ¸)
  - 1-1 ì†Œì œëª©
    - ë³´ì¶© ì„±ê²½êµ¬ì ˆ 1-2ê°œ
  - 1-2 ì†Œì œëª©
    - ë³´ì¶© ì„±ê²½êµ¬ì ˆ 1-2ê°œ
- 2ëŒ€ì§€ (ë‘ ë²ˆì§¸ í¬ì¸íŠ¸)
  - ë™ì¼ êµ¬ì¡°
- 3ëŒ€ì§€ (ì„¸ ë²ˆì§¸ í¬ì¸íŠ¸)
  - ë™ì¼ êµ¬ì¡°
- ê²°ë¡  (ì ìš© ë° ë§ˆë¬´ë¦¬)
"""

from typing import Dict, List, Any


class ThreePointsStyle:
    """3ëŒ€ì§€ ì„¤êµ ìŠ¤íƒ€ì¼"""

    id = "three_points"
    name = "3ëŒ€ì§€"
    description = "ì „í†µì ì¸ 3í¬ì¸íŠ¸ ì„¤êµ - ì„œë¡ , 3ê°œì˜ ëŒ€ì§€, ê²°ë¡ ìœ¼ë¡œ êµ¬ì„±"
    structure_type = "three_points"

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Step2 êµ¬ì¡° ì„¤ê³„ ì§€ì¹¨
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_step2_structure_guide() -> str:
        """Step2 êµ¬ì¡° ì„¤ê³„ë¥¼ ìœ„í•œ ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ 3ëŒ€ì§€ ì„¤êµ êµ¬ì¡° ì§€ì¹¨ ã€‘

â–¶ í•„ìˆ˜ êµ¬ì¡° (ë°˜ë“œì‹œ ì´ í˜•ì‹ì„ ë”°ë¥´ì„¸ìš”)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ (ë„ì…ë¶€)
   - ì²­ì¤‘ì˜ ê´€ì‹¬ì„ ë„ëŠ” ì‹œì‚¬ ì´ìŠˆ ë˜ëŠ” ìƒí™œ ì´ì•¼ê¸°
   - ì˜¤ëŠ˜ ë§ì”€ê³¼ ì—°ê²°ë˜ëŠ” ì§ˆë¬¸ì´ë‚˜ ìƒí™© ì œì‹œ
   - ë¶„ëŸ‰: ì „ì²´ì˜ 5~10%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ 1ëŒ€ì§€: [ì²« ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€]
   â”œâ”€â”€ 1-1. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â”œâ”€â”€ 1-2. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â””â”€â”€ ì ìš©ì : ì´ ëŒ€ì§€ì—ì„œ ì²­ì¤‘ì´ ì‹¤ì²œí•  ê²ƒ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ 2ëŒ€ì§€: [ë‘ ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€]
   â”œâ”€â”€ 2-1. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â”œâ”€â”€ 2-2. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â””â”€â”€ ì ìš©ì : ì´ ëŒ€ì§€ì—ì„œ ì²­ì¤‘ì´ ì‹¤ì²œí•  ê²ƒ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ 3ëŒ€ì§€: [ì„¸ ë²ˆì§¸ í•µì‹¬ ë©”ì‹œì§€ / í´ë¼ì´ë§¥ìŠ¤]
   â”œâ”€â”€ 3-1. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â”œâ”€â”€ 3-2. [ì†Œì œëª©]
   â”‚     â””â”€â”€ ë³´ì¶© ì„±ê²½êµ¬ì ˆ: (êµ¬ì ˆ 1-2ê°œ)
   â”‚     â””â”€â”€ ì„¤ëª… ë° ì˜ˆí™” íŒíŠ¸
   â””â”€â”€ ì ìš©ì : ì´ ëŒ€ì§€ì—ì„œ ì²­ì¤‘ì´ ì‹¤ì²œí•  ê²ƒ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ ê²°ë¡ 
   - ì„¸ ëŒ€ì§€ì˜ í•µì‹¬ ìš”ì•½ (1-2ë¬¸ì¥ì”©)
   - ì¢…í•© ì ìš©: ì˜¤ëŠ˜ ë°”ë¡œ ì‹¤ì²œí•  ê²ƒ 1-2ê°€ì§€
   - ì¶•ë³µ ë° ê¸°ë„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¶ ëŒ€ì§€ ì—°ê²° ì›ì¹™
1. 1ëŒ€ì§€ â†’ 2ëŒ€ì§€ â†’ 3ëŒ€ì§€ê°€ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ì•¼ í•¨
2. ì ì§„ì  ì‹¬í™” ë˜ëŠ” ìˆœì°¨ì  ì „ê°œ ê¶Œì¥
3. 3ëŒ€ì§€ëŠ” í´ë¼ì´ë§¥ìŠ¤ë¡œ ê°€ì¥ ê°•ë ¥í•œ ë©”ì‹œì§€

â–¶ ê° ëŒ€ì§€ ë¹„ì¤‘
- 1ëŒ€ì§€: 25~30%
- 2ëŒ€ì§€: 25~30%
- 3ëŒ€ì§€: 25~30%
- ë„ì…+ê²°ë¡ : 15~20%

â–¶ ì˜ˆí™” ë°°ì¹˜
- ê° ëŒ€ì§€ë§ˆë‹¤ ìµœì†Œ 1ê°œì˜ ì˜ˆí™” ê¶Œì¥
- 3ëŒ€ì§€ì— ê°€ì¥ ê°ë™ì ì¸ ì˜ˆí™” ë°°ì¹˜
"""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Step3/Step4 ì„¤êµë¬¸ ì‘ì„± ì§€ì¹¨
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_step3_writing_guide() -> str:
        """Step3 ì„¤êµë¬¸ ì‘ì„±ì„ ìœ„í•œ ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ 3ëŒ€ì§€ ì„¤êµë¬¸ ì‘ì„± ì§€ì¹¨ ã€‘

â–¶ í•„ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
â–¡ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ì´ ì²­ì¤‘ì˜ ê´€ì‹¬ì„ í™•ì‹¤íˆ ëŒì—ˆëŠ”ê°€?
â–¡ 3ê°œì˜ ëŒ€ì§€ê°€ ëª¨ë‘ í¬í•¨ë˜ì—ˆëŠ”ê°€?
â–¡ ê° ëŒ€ì§€ì— 1-1, 1-2 ì†Œì œëª© êµ¬ì¡°ê°€ ìˆëŠ”ê°€?
â–¡ ê° ì†Œì œëª©ì— ë³´ì¶© ì„±ê²½êµ¬ì ˆì´ 1-2ê°œ ìˆëŠ”ê°€?
â–¡ ê° ëŒ€ì§€ ëì— êµ¬ì²´ì  ì ìš©ì ì´ ìˆëŠ”ê°€?
â–¡ ê° ëŒ€ì§€ì— ì˜ˆí™”ê°€ ìµœì†Œ 1ê°œ ìˆëŠ”ê°€?
â–¡ ê²°ë¡ ì—ì„œ ì„¸ ëŒ€ì§€ê°€ ìš”ì•½ë˜ì—ˆëŠ”ê°€?
â–¡ ê²°ë¡ ì— ì‹¤ì²œ ê°€ëŠ¥í•œ ì ìš©ì´ ìˆëŠ”ê°€?

â–¶ ì‘ì„± ìˆœì„œ
1. ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ì‘ì„± (ì‹œì‚¬ ì´ìŠˆ ë˜ëŠ” ìƒí™œ ì´ì•¼ê¸°)
2. 1ëŒ€ì§€ â†’ 1-1, 1-2 ìˆœì„œë¡œ ì‘ì„±
3. 2ëŒ€ì§€ â†’ 2-1, 2-2 ìˆœì„œë¡œ ì‘ì„±
4. 3ëŒ€ì§€ â†’ 3-1, 3-2 ìˆœì„œë¡œ ì‘ì„± (ê°€ì¥ ê°•ë ¥í•˜ê²Œ)
5. ê²°ë¡  ì‘ì„± (ìš”ì•½ + ì ìš© + ì¶•ë³µ)

â–¶ ë¬¸ì²´ ì›ì¹™
- ê° ëŒ€ì§€ ì œëª©ì€ ëª…í™•í•˜ê³  ê¸°ì–µí•˜ê¸° ì‰½ê²Œ
- ì†Œì œëª©ì€ ëŒ€ì§€ë¥¼ êµ¬ì²´í™”í•˜ëŠ” ë‚´ìš©ìœ¼ë¡œ
- ë³´ì¶© ì„±ê²½êµ¬ì ˆì€ ë³¸ë¬¸ê³¼ ì—°ê´€ëœ ê²ƒìœ¼ë¡œ
- ì˜ˆí™”ëŠ” ë…¼ë€ ì—†ê³  ì²­ì¤‘ì´ ê³µê°í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ
"""

    @staticmethod
    def get_step3_checklist() -> List[str]:
        """Step3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°˜í™˜"""
        return [
            "ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹(ë„ì…ë¶€)ì´ ì²­ì¤‘ì˜ ê´€ì‹¬ì„ ëŒì—ˆëŠ”ê°€?",
            "1ëŒ€ì§€ê°€ 1-1, 1-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "2ëŒ€ì§€ê°€ 2-1, 2-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "3ëŒ€ì§€ê°€ 3-1, 3-2 ì†Œì œëª© êµ¬ì¡°ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ê°€?",
            "ê° ì†Œì œëª©ì— ë³´ì¶© ì„±ê²½êµ¬ì ˆì´ 1-2ê°œ í¬í•¨ë˜ì—ˆëŠ”ê°€?",
            "ê° ëŒ€ì§€ì— ì˜ˆí™”ê°€ ìµœì†Œ 1ê°œ ìˆëŠ”ê°€?",
            "ê° ëŒ€ì§€ ëì— êµ¬ì²´ì  ì ìš©ì ì´ ìˆëŠ”ê°€?",
            "ê²°ë¡ ì—ì„œ ì„¸ ëŒ€ì§€ì˜ í•µì‹¬ì´ ìš”ì•½ë˜ì—ˆëŠ”ê°€?",
            "ê²°ë¡ ì— ì˜¤ëŠ˜ ì‹¤ì²œí•  ì ìš©ì´ ìˆëŠ”ê°€?",
        ]

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ì˜ˆí™” ê°€ì´ë“œ
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_illustration_guide() -> str:
        """ì˜ˆí™” ë°°ì¹˜ ê°€ì´ë“œ ë°˜í™˜"""
        return """
ã€ 3ëŒ€ì§€ ì„¤êµ ì˜ˆí™” ë°°ì¹˜ ê°€ì´ë“œ ã€‘

â–¶ ì˜ˆí™” ë°°ì¹˜ ì›ì¹™
- 1ëŒ€ì§€: ë„ì…ì  ì˜ˆí™” (ê´€ì‹¬ ìœ ë„, ê³µê° í˜•ì„±)
- 2ëŒ€ì§€: ì‹¬í™” ì˜ˆí™” (êµí›ˆì , ì„¤ë“ë ¥ ìˆëŠ”)
- 3ëŒ€ì§€: ê°ë™ ì˜ˆí™” (ê°€ì¥ ê°•ë ¥í•œ ì˜ˆí™”, í´ë¼ì´ë§¥ìŠ¤)

â–¶ ì˜ˆí™” ìœ í˜• ì¶”ì²œ
- 1ëŒ€ì§€: ì¼ìƒ ìƒí™œ ì´ì•¼ê¸°, ë‰´ìŠ¤ ì‚¬ë¡€
- 2ëŒ€ì§€: ì—­ì‚¬ì  ì¸ë¬¼, ì„±ê²½ ì¸ë¬¼ ì‚¬ë¡€
- 3ëŒ€ì§€: ê°ë™ì ì¸ ê°œì¸ ê°„ì¦, ë³€í™” ìŠ¤í† ë¦¬

â–¶ ì£¼ì˜ì‚¬í•­
- ë…¼ë€ì˜ ì—¬ì§€ê°€ ìˆëŠ” ì •ì¹˜/ì‚¬íšŒ ì´ìŠˆ ê¸ˆì§€
- íŠ¹ì • ì¸ë¬¼ ë¹„ë°© ê¸ˆì§€
- ê° ì˜ˆí™”ëŠ” ì„¤êµ ë©”ì‹œì§€ì™€ ëª…í™•íˆ ì—°ê²°ë˜ì–´ì•¼ í•¨
"""

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # êµ¬ì¡° í…œí”Œë¦¿ (JSON)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    @staticmethod
    def get_structure_template() -> Dict[str, Any]:
        """Step2 ì¶œë ¥ìš© êµ¬ì¡° í…œí”Œë¦¿"""
        return {
            "style": "three_points",
            "style_name": "3ëŒ€ì§€",
            "ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹": {
                "content": "",
                "duration_percent": 5
            },
            "ëŒ€ì§€_1": {
                "title": "",
                "sub_1": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "illustration_hint": "",
                "application": ""
            },
            "ëŒ€ì§€_2": {
                "title": "",
                "sub_1": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "illustration_hint": "",
                "application": ""
            },
            "ëŒ€ì§€_3": {
                "title": "",
                "sub_1": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "sub_2": {
                    "title": "",
                    "supporting_verses": [],
                    "explanation": ""
                },
                "illustration_hint": "",
                "application": ""
            },
            "ê²°ë¡ ": {
                "summary": "",
                "final_application": "",
                "blessing": ""
            }
        }

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # í”„ë¡¬í”„íŠ¸ ë¹Œë”
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def build_step2_prompt(self, step1_result: Dict = None, context_data: Dict = None) -> str:
        """Step2 í”„ë¡¬í”„íŠ¸ ìƒì„±"""
        prompt = self.get_step2_structure_guide()

        if context_data:
            prompt += "\n\nã€ ì‹œëŒ€ ì»¨í…ìŠ¤íŠ¸ ã€‘\n"
            if context_data.get("concerns"):
                prompt += "ì²­ì¤‘ ê´€ì‹¬ì‚¬:\n"
                for concern in context_data.get("concerns", [])[:3]:
                    prompt += f"  - {concern}\n"

        prompt += "\n\nìœ„ êµ¬ì¡°ì— ë§ê²Œ ì„¤êµ êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì„¸ìš”."
        return prompt

    def build_step3_prompt(self, step2_result: Dict = None, duration: str = "20ë¶„") -> str:
        """Step3/Step4 í”„ë¡¬í”„íŠ¸ ìƒì„±"""
        from . import READABILITY_GUIDE

        prompt = self.get_step3_writing_guide()
        prompt += f"\n\nã€ ë¶„ëŸ‰ ã€‘\n{duration}\n"
        prompt += READABILITY_GUIDE
        prompt += "\n\nìœ„ ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ê°€ë…ì„± ì§€ì¹¨ì„ ëª¨ë‘ ì¶©ì¡±í•˜ëŠ” ì„¤êµë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”."
        return prompt
