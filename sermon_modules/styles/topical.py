"""
topical.py
μ£Όμ μ„¤κµ μ¤νƒ€μΌ - μ£Όμ  μ¤‘μ‹¬ μ„¤κµ κµ¬μ΅°

νΉμ§•:
- ν•λ‚μ μ£Όμ λ¥Ό λ‹¤κ°λ„λ΅ μ΅°λ…
- μ—¬λ¬ μ„±κ²½ κµ¬μ μ„ ν†µν•΄ μ£Όμ  μ „κ°
- λ€μ§€ κ°μ μμ  (2~4κ°)
- μ μ© μ¤‘μ‹¬μ κ²°λ΅ 

κµ¬μ΅°:
- λ„μ… (μ£Όμ  μ†κ°)
- μ£Όμ  μ „κ° (2~4κ° ν¬μΈνΈ)
- μ μ©/κ²°λ΅  (κµ¬μ²΄μ  μ‹¤μ² λ°©μ•)
"""

from typing import Dict, List, Any


class TopicalStyle:
    """μ£Όμ μ„¤κµ μ¤νƒ€μΌ"""

    id = "topical"
    name = "μ£Όμ μ„¤κµ"
    description = "μ£Όμ  μ¤‘μ‹¬ μ„¤κµ - ν•λ‚μ μ£Όμ λ¥Ό λ‹¤μ–‘ν• μ„±κ²½ κµ¬μ λ΅ μ΅°λ…"
    structure_type = "topical"

    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    # Step2 κµ¬μ΅° μ„¤κ³„ μ§€μΉ¨
    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    @staticmethod
    def get_step2_structure_guide() -> str:
        """Step2 κµ¬μ΅° μ„¤κ³„λ¥Ό μ„ν• κ°€μ΄λ“ λ°ν™"""
        return """
γ€ μ£Όμ μ„¤κµ κµ¬μ΅° μ§€μΉ¨ γ€‘

β–¶ ν•µμ‹¬ μ›μΉ™
- ν•λ‚μ λ…ν™•ν• μ£Όμ λ¥Ό μ¤‘μ‹¬μΌλ΅ μ „κ°
- μ—¬λ¬ μ„±κ²½ κµ¬μ μ΄ κ°™μ€ μ£Όμ λ¥Ό λ‹¤κ°λ„λ΅ μ΅°λ…
- μ μ©κ³Ό μ‹¤μ²μ΄ μ¤‘μ‹¬μ΄ λ¨
- λ€μ§€ κ°μλ” 2~4κ°λ΅ μμ λ΅­κ² κµ¬μ„±

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

π“ λ„μ… (μ£Όμ  μ†κ°)
   - μ¤λμ μ£Όμ  μ„ μ–Έ
   - μ™ μ΄ μ£Όμ κ°€ μ¤‘μ”ν•κ°€? (μ²­μ¤‘κ³Όμ μ—°κ²°)
   - μ£Όμ μ— λ€ν• μΌλ°μ  μ¤ν•΄ λλ” μ§λ¬Έ
   - λ¶„λ‰: μ „μ²΄μ 10~15%

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

π“ μ£Όμ  μ „κ° (2~4κ° ν¬μΈνΈ)

   β–Έ ν¬μΈνΈ 1: [μ£Όμ μ μ²« λ²μ§Έ μΈ΅λ©΄]
      - κ΄€λ ¨ μ„±κ²½ κµ¬μ  (1-3κ°)
      - μ„±κ²½μ  μ›λ¦¬ μ„¤λ…
      - ν„λ€μ  μ μ©

   β–Έ ν¬μΈνΈ 2: [μ£Όμ μ λ‘ λ²μ§Έ μΈ΅λ©΄]
      - κ΄€λ ¨ μ„±κ²½ κµ¬μ  (1-3κ°)
      - μ„±κ²½μ  μ›λ¦¬ μ„¤λ…
      - ν„λ€μ  μ μ©

   β–Έ (μ„ νƒ) ν¬μΈνΈ 3: [μ£Όμ μ μ„Έ λ²μ§Έ μΈ΅λ©΄]
      - κ΄€λ ¨ μ„±κ²½ κµ¬μ  (1-3κ°)
      - μ„±κ²½μ  μ›λ¦¬ μ„¤λ…
      - ν„λ€μ  μ μ©

   β–Έ (μ„ νƒ) ν¬μΈνΈ 4: [μ£Όμ μ λ„¤ λ²μ§Έ μΈ΅λ©΄]
      - κ΄€λ ¨ μ„±κ²½ κµ¬μ  (1-3κ°)
      - μ„±κ²½μ  μ›λ¦¬ μ„¤λ…
      - ν„λ€μ  μ μ©

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

π“ μ μ©/κ²°λ΅ 
   - μ£Όμ μ ν•µμ‹¬ μ”μ•½
   - κµ¬μ²΄μ  μ‹¤μ² λ°©μ• (3κ°€μ§€ μ΄μƒ)
   - μ¤λ λ°”λ΅ μ‹μ‘ν•  κ²ƒ 1κ°€μ§€
   - μ¶•λ³µ λ° κΈ°λ„
   - λ¶„λ‰: μ „μ²΄μ 15~20%

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

β–¶ μ£Όμ  μ„ μ • μ›μΉ™
1. μ²­μ¤‘μ μ‹¤μ  ν•„μ”μ™€ μ—°κ²°λ μ£Όμ 
2. μ„±κ²½μ  κ·Όκ±°κ°€ λ…ν™•ν• μ£Όμ 
3. κµ¬μ²΄μ  μ μ©μ΄ κ°€λ¥ν• μ£Όμ 

β–¶ μ„±κ²½ κµ¬μ  μ„ νƒ μ›μΉ™
- λ³Έλ¬Έ μ™Έμ— 2~5κ°μ λ³΄μ΅° κµ¬μ  μ‚¬μ©
- κµ¬μ•½/μ‹ μ•½ κ· ν•μκ² μΈμ©
- κ° ν¬μΈνΈλ§λ‹¤ λ‹¤λ¥Έ κµ¬μ  μ‚¬μ©

β–¶ κ° ν¬μΈνΈ λΉ„μ¤‘
- κ° ν¬μΈνΈλ” κ±°μ λ™μΌν• λΉ„μ¤‘ (20~25%)
- λ§μ§€λ§‰ ν¬μΈνΈλ¥Ό μ•½κ°„ κ°•μ΅°ν•΄λ„ μΆ‹μ
"""

    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    # Step3/Step4 μ„¤κµλ¬Έ μ‘μ„± μ§€μΉ¨
    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    @staticmethod
    def get_step3_writing_guide() -> str:
        """Step3 μ„¤κµλ¬Έ μ‘μ„±μ„ μ„ν• κ°€μ΄λ“ λ°ν™"""
        return """
γ€ μ£Όμ μ„¤κµ μ‘μ„± μ§€μΉ¨ γ€‘

β–¶ ν•„μ μ²΄ν¬λ¦¬μ¤νΈ
β–΅ μ£Όμ κ°€ λ„μ…λ¶€μ—μ„ λ…ν™•ν μ„ μ–Έλμ—λ”κ°€?
β–΅ μ™ μ΄ μ£Όμ κ°€ μ¤‘μ”ν•μ§€ μ„¤λ…ν–λ”κ°€?
β–΅ κ° ν¬μΈνΈκ°€ κ°™μ€ μ£Όμ λ¥Ό λ‹¤κ°λ„λ΅ μ΅°λ…ν•λ”κ°€?
β–΅ κ° ν¬μΈνΈμ— μ„±κ²½μ  κ·Όκ±°κ°€ μλ”κ°€?
β–΅ κ° ν¬μΈνΈμ— ν„λ€μ  μ μ©μ΄ ν¬ν•¨λμ—λ”κ°€?
β–΅ κ²°λ΅ μ— κµ¬μ²΄μ  μ‹¤μ² λ°©μ•μ΄ 3κ°€μ§€ μ΄μƒ μλ”κ°€?
β–΅ "μ¤λ λ°”λ΅ μ‹μ‘ν•  κ²ƒ" 1κ°€μ§€κ°€ μλ”κ°€?

β–¶ μ‘μ„± μμ„
1. λ„μ…: μ£Όμ  μ„ μ–Έ + μ²­μ¤‘ μ—°κ²°
2. ν¬μΈνΈλ³„ μ „κ° (μ„±κ²½κµ¬μ  β†’ μ›λ¦¬ β†’ μ μ©)
3. κ²°λ΅ : μ”μ•½ + μ‹¤μ² λ°©μ• + μ¶•λ³µ

β–¶ λ¬Έμ²΄ μ›μΉ™
- μ£Όμ κ°€ λ¨λ“  ν¬μΈνΈλ¥Ό κ΄€ν†µν•΄μ•Ό ν•¨
- μ μ©μ€ κµ¬μ²΄μ μ΄κ³  μ‹¤μ² κ°€λ¥ν•΄μ•Ό ν•¨
- μ„±κ²½ κµ¬μ μ€ μ£Όμ λ¥Ό λ’·λ°›μΉ¨ν•΄μ•Ό ν•¨
- μν™”λ” μ£Όμ μ™€ μ§μ ‘ μ—°κ²°λμ–΄μ•Ό ν•¨

β–¶ μ£Όμ μ„¤κµμ κ°•μ  ν™μ©
- μ²­μ¤‘μ μ‹¤μ  μ‚¶μ λ¬Έμ  ν•΄κ²°μ— μ΄μ 
- μ—¬λ¬ μ„±κ²½ κµ¬μ μ„ ν†µν• ν’μ„±ν• κ·Όκ±°
- λ…ν™•ν• μ μ©κ³Ό μ‹¤μ² λ°©μ• μ μ‹
"""

    @staticmethod
    def get_step3_checklist() -> List[str]:
        """Step3 μ²΄ν¬λ¦¬μ¤νΈ λ°ν™"""
        return [
            "μ£Όμ κ°€ λ„μ…λ¶€μ—μ„ λ…ν™•ν μ„ μ–Έλμ—λ”κ°€?",
            "μ£Όμ μ μ¤‘μ”μ„±μ΄ μ²­μ¤‘κ³Ό μ—°κ²°λμ–΄ μ„¤λ…λμ—λ”κ°€?",
            "κ° ν¬μΈνΈκ°€ μ£Όμ λ¥Ό λ‹¤κ°λ„λ΅ μ΅°λ…ν•λ”κ°€?",
            "κ° ν¬μΈνΈμ— 1~3κ°μ μ„±κ²½ κµ¬μ μ΄ μΈμ©λμ—λ”κ°€?",
            "κ° ν¬μΈνΈμ— ν„λ€μ  μ μ©μ΄ ν¬ν•¨λμ—λ”κ°€?",
            "ν¬μΈνΈλ“¤μ΄ λ…Όλ¦¬μ μΌλ΅ μ—°κ²°λμ—λ”κ°€?",
            "κ²°λ΅ μ— μ£Όμ μ ν•µμ‹¬μ΄ μ”μ•½λμ—λ”κ°€?",
            "κµ¬μ²΄μ  μ‹¤μ² λ°©μ•μ΄ 3κ°€μ§€ μ΄μƒ μ μ‹λμ—λ”κ°€?",
            "μ¤λ λ°”λ΅ μ‹μ‘ν•  κ²ƒ 1κ°€μ§€κ°€ μλ”κ°€?",
        ]

    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    # μν™” κ°€μ΄λ“
    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    @staticmethod
    def get_illustration_guide() -> str:
        """μν™” λ°°μΉ κ°€μ΄λ“ λ°ν™"""
        return """
γ€ μ£Όμ μ„¤κµ μν™” λ°°μΉ κ°€μ΄λ“ γ€‘

β–¶ μν™” λ°°μΉ μ›μΉ™
- λ„μ…: μ£Όμ μ™€ κ΄€λ ¨λ μƒν™ μ‚¬λ΅€ (κ΄€μ‹¬ μ λ„)
- κ° ν¬μΈνΈ: ν•΄λ‹Ή μΈ΅λ©΄μ„ μ„¤λ…ν•λ” μν™”
- κ²°λ΅ : λ³€ν™”/μ„±κ³µ μ‚¬λ΅€ (μ‹¤μ² λ™κΈ° λ¶€μ—¬)

β–¶ μν™” μ ν• μ¶”μ²
- μ£Όμ μ™€ μ§μ ‘ μ—°κ²°λ ν„λ€ μ‚¬λ΅€
- μ„±κ²½ μΈλ¬Ό μ¤‘ μ£Όμ μ™€ κ΄€λ ¨λ μ‚¬λ΅€
- μ²­μ¤‘μ΄ κ³µκ°ν•  μ μλ” μΌμƒ μ΄μ•ΌκΈ°

β–¶ μ£Όμμ‚¬ν•­
- λ¨λ“  μν™”λ” κ°™μ€ μ£Όμ λ¥Ό ν–¥ν•΄μ•Ό ν•¨
- μν™”κ°€ μ£Όμ μ—μ„ λ²—μ–΄λ‚μ§€ μ•λ„λ΅ μ£Όμ
- μ μ©μΌλ΅ μμ—°μ¤λ½κ² μ—°κ²°λμ–΄μ•Ό ν•¨
"""

    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    # κµ¬μ΅° ν…ν”λ¦Ώ (JSON)
    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    @staticmethod
    def get_structure_template() -> Dict[str, Any]:
        """Step2 μ¶λ ¥μ© κµ¬μ΅° ν…ν”λ¦Ώ"""
        return {
            "style": "topical",
            "style_name": "μ£Όμ μ„¤κµ",
            "μ£Όμ ": "",
            "λ„μ…": {
                "theme_statement": "",
                "importance": "",
                "connection_to_audience": "",
                "duration_percent": 10
            },
            "ν¬μΈνΈλ“¤": [
                {
                    "number": 1,
                    "title": "",
                    "related_verses": [],
                    "biblical_principle": "",
                    "modern_application": "",
                    "illustration_hint": ""
                },
                {
                    "number": 2,
                    "title": "",
                    "related_verses": [],
                    "biblical_principle": "",
                    "modern_application": "",
                    "illustration_hint": ""
                }
            ],
            "μ μ©_κ²°λ΅ ": {
                "summary": "",
                "practical_steps": [],
                "today_action": "",
                "blessing": ""
            }
        }

    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    # ν”„λ΅¬ν”„νΈ λΉλ”
    # β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    def build_step2_prompt(self, step1_result: Dict = None, context_data: Dict = None) -> str:
        """Step2 ν”„λ΅¬ν”„νΈ μƒμ„±"""
        prompt = self.get_step2_structure_guide()

        if context_data:
            prompt += "\n\nγ€ μ‹λ€ μ»¨ν…μ¤νΈ γ€‘\n"
            if context_data.get("concerns"):
                prompt += "μ²­μ¤‘ κ΄€μ‹¬μ‚¬ (μ£Όμ μ™€ μ—°κ²°ν•μ„Έμ”):\n"
                for concern in context_data.get("concerns", [])[:3]:
                    prompt += f"  - {concern}\n"

        prompt += "\n\nμ„ κµ¬μ΅°μ— λ§κ² μ£Όμ μ„¤κµ κµ¬μ΅°λ¥Ό μ„¤κ³„ν•μ„Έμ”."
        prompt += "\nν¬μΈνΈ κ°μλ” 2~4κ° μ¤‘ μ£Όμ μ— λ§κ² μ„ νƒν•μ„Έμ”."
        return prompt

    def build_step3_prompt(self, step2_result: Dict = None, duration: str = "20λ¶„") -> str:
        """Step3/Step4 ν”„λ΅¬ν”„νΈ μƒμ„±"""
        from . import READABILITY_GUIDE

        prompt = self.get_step3_writing_guide()
        prompt += f"\n\nγ€ λ¶„λ‰ γ€‘\n{duration}\n"
        prompt += READABILITY_GUIDE
        prompt += "\n\nμ„ μ²΄ν¬λ¦¬μ¤νΈμ™€ κ°€λ…μ„± μ§€μΉ¨μ„ λ¨λ‘ μ¶©μ΅±ν•λ” μ£Όμ μ„¤κµλ¥Ό μ‘μ„±ν•μ„Έμ”."
        prompt += "\nνΉν μ μ©κ³Ό μ‹¤μ² λ°©μ•μ„ κµ¬μ²΄μ μΌλ΅ μ μ‹ν•μ„Έμ”."
        return prompt
