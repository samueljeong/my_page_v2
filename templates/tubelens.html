<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TubeLens - YouTube Analytics</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%23FF0000' width='32' height='32' rx='6'/><text x='16' y='22' font-size='16' fill='white' text-anchor='middle' font-weight='bold'>T</text></svg>">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tubelens.css') }}?v={{ range(1000, 9999) | random }}">
</head>
<body>
  <!-- Auth Header -->
  <div class="auth-header">
    <div class="header-left">
      <h1>TubeLens</h1>
      <span class="header-subtitle">YouTube Analytics Tool</span>
    </div>
    <div class="auth-links">
      <button id="btn-settings" class="btn-header" onclick="TubeLens.openSettings()">API 키 설정</button>
      <a href="/" class="btn-home">홈</a>
    </div>
  </div>

  <!-- Main Layout with Sidebar -->
  <div class="main-layout">
    <!-- Left Sidebar Navigation -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a href="/drama" class="sidebar-item" data-page="drama">
          <span class="sidebar-icon">🎬</span>
          <span class="sidebar-label">드라마 제작</span>
        </a>
        <a href="/image" class="sidebar-item" data-page="image">
          <span class="sidebar-icon">🖼️</span>
          <span class="sidebar-label">이미지 제작</span>
        </a>
        <a href="/tubelens" class="sidebar-item active" data-page="tubelens">
          <span class="sidebar-icon">📊</span>
          <span class="sidebar-label">TubeLens</span>
        </a>
        <a href="/product" class="sidebar-item" data-page="product">
          <span class="sidebar-icon">📦</span>
          <span class="sidebar-label">상품 제작</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <div class="main-content">
      <div id="tubelens-app">
        <!-- 검색 패널 -->
        <div class="search-panel">
          <div class="panel-header">
            <h2>YouTube 검색 & 분석</h2>
          </div>

          <div class="search-section">
            <!-- URL 분석 -->
            <div class="search-row">
              <div class="input-group url-input-group">
                <label>URL 분석</label>
                <div class="input-with-button">
                  <input type="text" id="youtube-url" placeholder="YouTube 영상 또는 채널 URL 입력" />
                  <button class="btn btn-analyze" onclick="TubeLens.analyzeUrl()">분석</button>
                </div>
              </div>
            </div>

            <!-- 키워드 검색 -->
            <div class="search-row">
              <div class="input-group keyword-input-group">
                <label>키워드 검색</label>
                <div class="input-with-button">
                  <input type="text" id="search-keyword" placeholder="검색할 키워드 입력" onkeypress="if(event.key==='Enter') TubeLens.startSearch()" />
                  <button class="btn btn-search" onclick="TubeLens.startSearch()">검색</button>
                </div>
              </div>
            </div>

            <!-- 검색 옵션 -->
            <div class="search-options">
              <div class="option-group">
                <label>검색 모드</label>
                <div class="toggle-buttons">
                  <button class="toggle-btn active" id="btn-video-search" onclick="TubeLens.setSearchMode('video')">영상 검색</button>
                  <button class="toggle-btn" id="btn-channel-search" onclick="TubeLens.setSearchMode('channel')">채널 검색</button>
                </div>
              </div>

              <div class="option-group">
                <label>정렬</label>
                <div class="toggle-buttons">
                  <button class="toggle-btn active" id="btn-sort-views" onclick="TubeLens.setSort('views')">조회수순</button>
                  <button class="toggle-btn" id="btn-sort-date" onclick="TubeLens.setSort('date')">최신순</button>
                </div>
              </div>

              <div class="option-group">
                <label>영상 타입</label>
                <select id="video-type" class="select-input">
                  <option value="all">쇼츠+롱폼</option>
                  <option value="shorts">쇼츠 (60초 이하)</option>
                  <option value="longform_4_20">롱폼 4~20분</option>
                  <option value="longform_20_plus">롱폼 20분+</option>
                </select>
              </div>

              <div class="option-group">
                <label>수집 개수</label>
                <select id="max-results" class="select-input">
                  <option value="50">50개</option>
                  <option value="100" selected>100개</option>
                  <option value="200">200개</option>
                  <option value="500">500개</option>
                </select>
              </div>

              <div class="option-group">
                <label>기간</label>
                <select id="time-frame" class="select-input">
                  <option value="">전체 기간</option>
                  <option value="hour">1시간 이내</option>
                  <option value="day">1일 이내</option>
                  <option value="week">7일 이내</option>
                  <option value="month" selected>1개월 이내</option>
                  <option value="3months">3개월 이내</option>
                  <option value="6months">6개월 이내</option>
                  <option value="year">1년 이내</option>
                </select>
              </div>

              <div class="option-group">
                <label>국가</label>
                <select id="region-code" class="select-input">
                  <option value="KR" selected>한국</option>
                  <option value="US">미국</option>
                  <option value="JP">일본</option>
                  <option value="TW">대만</option>
                  <option value="GB">영국</option>
                  <option value="DE">독일</option>
                  <option value="FR">프랑스</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- 필터 패널 -->
        <div class="filter-panel">
          <div class="panel-header">
            <h3>필터 설정</h3>
            <div class="filter-actions">
              <button class="btn btn-filter-apply" onclick="TubeLens.applyFilters()">필터 적용</button>
              <button class="btn btn-filter-clear" onclick="TubeLens.clearFilters()">필터 해제</button>
            </div>
          </div>

          <div class="filter-options">
            <div class="filter-group">
              <label>CII 필터</label>
              <div class="cii-buttons">
                <button class="cii-btn" id="cii-great" onclick="TubeLens.toggleCiiFilter('great')">Great!!</button>
                <button class="cii-btn" id="cii-good" onclick="TubeLens.toggleCiiFilter('good')">Good</button>
                <button class="cii-btn" id="cii-soso" onclick="TubeLens.toggleCiiFilter('soso')">Soso</button>
              </div>
            </div>

            <div class="filter-group">
              <label>조회수</label>
              <select id="view-count-filter" class="select-input">
                <option value="">전체</option>
                <option value="10000">1만 이상</option>
                <option value="50000">5만 이상</option>
                <option value="100000">10만 이상</option>
                <option value="500000">50만 이상</option>
                <option value="1000000">100만 이상</option>
              </select>
            </div>

            <div class="filter-group">
              <label>구독자수</label>
              <select id="subscriber-filter" class="select-input">
                <option value="">전체</option>
                <option value="1000">1천명 이하</option>
                <option value="5000">5천명 이하</option>
                <option value="10000">1만명 이하</option>
                <option value="50000">5만명 이하</option>
                <option value="100000">10만명 이하</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 결과 테이블 -->
        <div class="results-panel">
          <div class="panel-header">
            <h3>검색 결과 <span id="result-count">(0개)</span></h3>
            <button class="btn btn-clear" onclick="TubeLens.clearResults()">결과 초기화</button>
          </div>

          <div class="results-container">
            <!-- 로딩 인디케이터 -->
            <div id="loading-indicator" class="loading" style="display: none;">
              <div class="loading-spinner"></div>
              <div>YouTube 데이터 분석 중...</div>
            </div>

            <!-- 결과 테이블 -->
            <div class="table-wrapper">
              <table class="results-table" id="results-table">
                <thead>
                  <tr>
                    <th style="width: 40px;">N</th>
                    <th style="width: 140px;">썸네일</th>
                    <th style="width: 100px;">채널명</th>
                    <th style="width: 200px;">제목</th>
                    <th style="width: 90px;">게시일</th>
                    <th style="width: 80px;">구독자</th>
                    <th style="width: 80px;">조회수</th>
                    <th style="width: 80px;">기여도</th>
                    <th style="width: 70px;">성과도</th>
                    <th style="width: 70px;">CII</th>
                    <th style="width: 60px;">길이</th>
                    <th style="width: 70px;">좋아요</th>
                    <th style="width: 60px;">댓글</th>
                    <th style="width: 60px;">참여율</th>
                  </tr>
                </thead>
                <tbody id="results-body">
                  <!-- 결과가 여기에 표시됩니다 -->
                </tbody>
              </table>
            </div>

            <!-- 빈 결과 -->
            <div id="empty-results" class="empty-results">
              <div class="empty-icon">🔍</div>
              <p>검색 결과가 없습니다</p>
              <p class="empty-hint">키워드를 입력하고 검색 버튼을 클릭하세요</p>
            </div>
          </div>
        </div>

        <!-- 상태바 -->
        <div class="status-bar">
          <span id="status-text">준비됨 - API 키를 설정해주세요</span>
        </div>
      </div>
    </div>
  </div>

  <!-- API 키 설정 모달 -->
  <div id="settings-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>YouTube API 키 설정</h3>
        <button class="modal-close" onclick="TubeLens.closeSettings()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>새 API 키 추가</label>
          <div class="input-with-button">
            <input type="password" id="new-api-key" placeholder="API 키 입력" />
            <button class="btn btn-add" onclick="TubeLens.addApiKey()">추가</button>
          </div>
          <small class="help-text">Google Cloud Console에서 YouTube Data API v3 키를 발급받으세요</small>
        </div>

        <div class="form-group">
          <label>등록된 API 키</label>
          <div id="api-keys-list" class="api-keys-list">
            <div class="empty-keys">등록된 API 키가 없습니다</div>
          </div>
        </div>

        <div class="modal-buttons">
          <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com" target="_blank" class="btn btn-guide">API 키 발급받기</a>
          <button class="btn btn-close" onclick="TubeLens.closeSettings()">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 채널 선택 모달 -->
  <div id="channel-modal" class="modal" style="display: none;">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h3>채널 선택</h3>
        <button class="modal-close" onclick="TubeLens.closeChannelModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="channel-list" class="channel-list">
          <!-- 채널 목록이 여기에 표시됩니다 -->
        </div>
        <div class="channel-options">
          <label>영상 타입:</label>
          <select id="channel-video-type" class="select-input">
            <option value="all">쇼츠+롱폼</option>
            <option value="shorts">쇼츠</option>
            <option value="longform">롱폼</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- 댓글 모달 -->
  <div id="comments-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>베스트 댓글</h3>
        <button class="modal-close" onclick="TubeLens.closeCommentsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="comments-list" class="comments-list">
          <!-- 댓글 목록이 여기에 표시됩니다 -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-copy" onclick="TubeLens.copyComments()">댓글 복사</button>
        <button class="btn btn-close" onclick="TubeLens.closeCommentsModal()">닫기</button>
      </div>
    </div>
  </div>

  <!-- 영상 재생 모달 -->
  <div id="video-modal" class="modal" style="display: none;">
    <div class="modal-content modal-video">
      <div class="modal-header">
        <h3 id="video-modal-title">영상 재생</h3>
        <button class="modal-close" onclick="TubeLens.closeVideoModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="video-container">
          <iframe id="video-iframe" width="100%" height="400" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-youtube" onclick="TubeLens.openYouTube()">YouTube에서 보기</button>
        <button class="btn btn-close" onclick="TubeLens.closeVideoModal()">닫기</button>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/tubelens-main.js') }}?v={{ range(1000, 9999) | random }}"></script>
</body>
</html>
