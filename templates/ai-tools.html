<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Tools - Claude ë³´ì¡° ë„êµ¬</title>
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --youtube: #ff0000;
      --image: #10b981;
      --trend: #f59e0b;
      --vision: #8b5cf6;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --bg-input: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #475569;
      --radius: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--bg-card);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Main Layout */
    .main-container {
      display: grid;
      grid-template-columns: 280px 1fr 350px;
      height: calc(100vh - 60px);
    }

    /* Tool Sidebar */
    .tool-sidebar {
      background: var(--bg-card);
      border-right: 1px solid var(--border);
      padding: 1rem;
      overflow-y: auto;
    }

    .tool-section {
      margin-bottom: 1.5rem;
    }

    .tool-section h3 {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }

    .tool-card {
      padding: 1rem;
      background: var(--bg);
      border-radius: var(--radius);
      margin-bottom: 0.5rem;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .tool-card:hover {
      border-color: var(--border);
    }

    .tool-card.active {
      border-color: var(--primary);
      background: rgba(99, 102, 241, 0.1);
    }

    .tool-card.active.youtube { border-color: var(--youtube); background: rgba(255, 0, 0, 0.1); }
    .tool-card.active.image { border-color: var(--image); background: rgba(16, 185, 129, 0.1); }
    .tool-card.active.trend { border-color: var(--trend); background: rgba(245, 158, 11, 0.1); }
    .tool-card.active.vision { border-color: var(--vision); background: rgba(139, 92, 246, 0.1); }

    .tool-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .tool-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .tool-icon.youtube { background: var(--youtube); }
    .tool-icon.image { background: var(--image); }
    .tool-icon.trend { background: var(--trend); }
    .tool-icon.vision { background: var(--vision); }

    .tool-name {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .tool-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.4;
    }

    /* Work Area */
    .work-area {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .tool-config {
      padding: 1.5rem;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
    }

    .tool-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .config-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .config-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .config-group.full {
      grid-column: 1 / -1;
    }

    .config-group label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .config-group input,
    .config-group select,
    .config-group textarea {
      padding: 0.625rem 0.75rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.9rem;
    }

    .config-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .config-group input:focus,
    .config-group select:focus,
    .config-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-primary:disabled {
      background: var(--bg-input);
      cursor: not-allowed;
    }

    .btn-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* Results Area */
    .results-area {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .result-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .result-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .result-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .result-content {
      font-size: 0.9rem;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .result-image {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }

    .result-video {
      display: flex;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--bg);
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .result-video img {
      width: 120px;
      height: 68px;
      object-fit: cover;
      border-radius: 4px;
    }

    .result-video-info {
      flex: 1;
    }

    .result-video-title {
      font-weight: 500;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .result-video-channel {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .result-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .btn-small {
      padding: 0.375rem 0.75rem;
      font-size: 0.8rem;
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-small:hover {
      background: var(--border);
    }

    /* Chat Panel */
    .chat-panel {
      background: var(--bg-card);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .chat-message {
      margin-bottom: 1rem;
      max-width: 90%;
    }

    .chat-message.user {
      margin-left: auto;
    }

    .chat-message.user .chat-bubble {
      background: var(--primary);
      color: white;
    }

    .chat-message.assistant .chat-bubble {
      background: var(--bg);
      border: 1px solid var(--border);
    }

    .chat-bubble {
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .chat-sender {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .chat-input-area {
      padding: 1rem;
      border-top: 1px solid var(--border);
    }

    .chat-input-row {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex: 1;
      padding: 0.75rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.9rem;
      resize: none;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-muted);
      font-size: 0.9rem;
      padding: 1rem;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show { opacity: 1; }

    /* Responsive */
    @media (max-width: 1024px) {
      .main-container {
        grid-template-columns: 1fr;
      }
      .tool-sidebar, .chat-panel {
        display: none;
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <div>
      <h1>ğŸ› ï¸ AI Tools</h1>
      <div class="header-desc">Claudeê°€ ëª»í•˜ëŠ” ê²ƒì„ ë„ì™€ì£¼ëŠ” ë„êµ¬ë“¤</div>
    </div>
  </header>

  <div class="main-container">
    <!-- Tool Sidebar -->
    <aside class="tool-sidebar">
      <div class="tool-section">
        <h3>ğŸ” ë¦¬ì„œì¹˜ ë„êµ¬</h3>

        <div class="tool-card youtube" onclick="selectTool('youtube')" id="tool-youtube">
          <div class="tool-header">
            <div class="tool-icon youtube">â–¶</div>
            <div class="tool-name">YouTube ë¦¬ì„œì²˜</div>
          </div>
          <div class="tool-desc">ì˜ìƒ ê²€ìƒ‰, ìë§‰ ì¶”ì¶œ, ëŒ“ê¸€ ë¶„ì„</div>
        </div>

        <div class="tool-card trend" onclick="selectTool('trend')" id="tool-trend">
          <div class="tool-header">
            <div class="tool-icon trend">ğŸ“ˆ</div>
            <div class="tool-name">íŠ¸ë Œë“œ ìŠ¤ìºë„ˆ</div>
          </div>
          <div class="tool-desc">ì‹¤ì‹œê°„ ë‰´ìŠ¤, ê²€ìƒ‰ì–´, íŠ¸ë Œë“œ</div>
        </div>
      </div>

      <div class="tool-section">
        <h3>ğŸ¨ ìƒì„± ë„êµ¬</h3>

        <div class="tool-card image" onclick="selectTool('image')" id="tool-image">
          <div class="tool-header">
            <div class="tool-icon image">ğŸ–¼ï¸</div>
            <div class="tool-name">ì´ë¯¸ì§€ ìƒì„±ê¸°</div>
          </div>
          <div class="tool-desc">Gemini Imagenìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±</div>
        </div>
      </div>

      <div class="tool-section">
        <h3>ğŸ‘ï¸ ë¶„ì„ ë„êµ¬</h3>

        <div class="tool-card vision" onclick="selectTool('vision')" id="tool-vision">
          <div class="tool-header">
            <div class="tool-icon vision">ğŸ”¬</div>
            <div class="tool-name">ì´ë¯¸ì§€ ë¶„ì„ê¸°</div>
          </div>
          <div class="tool-desc">ì´ë¯¸ì§€/URL ë‚´ìš© ë¶„ì„ (Vision)</div>
        </div>
      </div>
    </aside>

    <!-- Work Area -->
    <main class="work-area">
      <!-- Tool Config - YouTube -->
      <div class="tool-config" id="config-youtube" style="display:none;">
        <div class="tool-title">â–¶ YouTube ë¦¬ì„œì²˜</div>
        <div class="config-grid">
          <div class="config-group full">
            <label>ê²€ìƒ‰ì–´ ë˜ëŠ” YouTube URL</label>
            <input type="text" id="yt-query" placeholder="ê²€ìƒ‰ì–´ ë˜ëŠ” https://youtube.com/watch?v=...">
          </div>
          <div class="config-group">
            <label>ì‘ì—… ìœ í˜•</label>
            <select id="yt-action">
              <option value="search">ì˜ìƒ ê²€ìƒ‰</option>
              <option value="transcript">ìë§‰ ì¶”ì¶œ</option>
              <option value="comments">ëŒ“ê¸€ ë¶„ì„</option>
              <option value="channel">ì±„ë„ ë¶„ì„</option>
            </select>
          </div>
          <div class="config-group">
            <label>ê²€ìƒ‰ ê²°ê³¼ ìˆ˜</label>
            <input type="number" id="yt-limit" value="10" min="1" max="50">
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="runYouTube()">ğŸ” ì‹¤í–‰</button>
        </div>
      </div>

      <!-- Tool Config - Trend -->
      <div class="tool-config" id="config-trend" style="display:none;">
        <div class="tool-title">ğŸ“ˆ íŠ¸ë Œë“œ ìŠ¤ìºë„ˆ</div>
        <div class="config-grid">
          <div class="config-group">
            <label>ì†ŒìŠ¤</label>
            <select id="trend-source">
              <option value="news">ë‰´ìŠ¤ (Google News)</option>
              <option value="search">ê²€ìƒ‰ì–´ íŠ¸ë Œë“œ</option>
              <option value="social">ì†Œì…œ ë¯¸ë””ì–´</option>
            </select>
          </div>
          <div class="config-group">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="trend-category">
              <option value="all">ì „ì²´</option>
              <option value="economy">ê²½ì œ</option>
              <option value="tech">ê¸°ìˆ </option>
              <option value="entertainment">ì—°ì˜ˆ</option>
              <option value="sports">ìŠ¤í¬ì¸ </option>
            </select>
          </div>
          <div class="config-group full">
            <label>í‚¤ì›Œë“œ í•„í„° (ì„ íƒ)</label>
            <input type="text" id="trend-keyword" placeholder="íŠ¹ì • í‚¤ì›Œë“œë¡œ í•„í„°ë§...">
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="runTrend()">ğŸ“ˆ ìŠ¤ìº”</button>
        </div>
      </div>

      <!-- Tool Config - Image -->
      <div class="tool-config" id="config-image" style="display:none;">
        <div class="tool-title">ğŸ–¼ï¸ ì´ë¯¸ì§€ ìƒì„±ê¸°</div>
        <div class="config-grid">
          <div class="config-group full">
            <label>ì´ë¯¸ì§€ ì„¤ëª… (í•œê¸€ ê°€ëŠ¥)</label>
            <textarea id="img-prompt" placeholder="ìƒì„±í•  ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ì„¤ëª…í•˜ì„¸ìš”..."></textarea>
          </div>
          <div class="config-group">
            <label>ìŠ¤íƒ€ì¼</label>
            <select id="img-style">
              <option value="realistic">ì‚¬ì‹¤ì </option>
              <option value="webtoon">ì›¹íˆ°/ë§Œí™”</option>
              <option value="cinematic">ì‹œë„¤ë§ˆí‹±</option>
              <option value="illustration">ì¼ëŸ¬ìŠ¤íŠ¸</option>
              <option value="3d">3D ë Œë”</option>
            </select>
          </div>
          <div class="config-group">
            <label>ë¹„ìœ¨</label>
            <select id="img-ratio">
              <option value="16:9">16:9 (ê°€ë¡œ)</option>
              <option value="9:16">9:16 (ì„¸ë¡œ)</option>
              <option value="1:1">1:1 (ì •ì‚¬ê°í˜•)</option>
              <option value="4:3">4:3</option>
            </select>
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="runImageGen()">ğŸ¨ ìƒì„±</button>
        </div>
      </div>

      <!-- Tool Config - Vision -->
      <div class="tool-config" id="config-vision" style="display:none;">
        <div class="tool-title">ğŸ”¬ ì´ë¯¸ì§€ ë¶„ì„ê¸°</div>
        <div class="config-grid">
          <div class="config-group full">
            <label>ì´ë¯¸ì§€ URL ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ</label>
            <input type="text" id="vision-url" placeholder="https://... ì´ë¯¸ì§€ URL">
          </div>
          <div class="config-group full">
            <input type="file" id="vision-file" accept="image/*" style="margin-top:0.5rem;">
          </div>
          <div class="config-group full">
            <label>ë¶„ì„ ìš”ì²­ (ì„ íƒ)</label>
            <input type="text" id="vision-prompt" placeholder="ì´ ì´ë¯¸ì§€ì—ì„œ ë¬´ì—‡ì„ ë¶„ì„í• ê¹Œìš”?">
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="runVision()">ğŸ”¬ ë¶„ì„</button>
        </div>
      </div>

      <!-- Default Config -->
      <div class="tool-config" id="config-default">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ‘ˆ</div>
          <div>ì™¼ìª½ì—ì„œ ë„êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
      </div>

      <!-- Results Area -->
      <div class="results-area" id="results">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ› ï¸</div>
          <div>ë„êµ¬ë¥¼ ì„ íƒí•˜ê³  ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
      </div>
    </main>

    <!-- Chat Panel -->
    <aside class="chat-panel">
      <div class="chat-header">ğŸ’¬ ê²°ê³¼ í™œìš©í•˜ê¸°</div>
      <div class="chat-messages" id="chatMessages">
        <div class="chat-message assistant">
          <div class="chat-sender">Assistant</div>
          <div class="chat-bubble">
            ë„êµ¬ ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´, ì—¬ê¸°ì„œ ì¶”ê°€ ì§ˆë¬¸ì´ë‚˜ ìš”ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <br><br>
            ì˜ˆì‹œ:
            <br>â€¢ "ì´ ì˜ìƒë“¤ ìš”ì•½í•´ì¤˜"
            <br>â€¢ "ì´ íŠ¸ë Œë“œë¡œ ì½˜í…ì¸  ì•„ì´ë””ì–´ ì¤˜"
            <br>â€¢ "ì´ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ê°œì„ í•´ì¤˜"
          </div>
        </div>
      </div>
      <div class="chat-input-area">
        <div class="chat-input-row">
          <textarea class="chat-input" id="chatInput" placeholder="ê²°ê³¼ì— ëŒ€í•´ ì§ˆë¬¸í•˜ì„¸ìš”..." rows="2"></textarea>
          <button class="btn btn-primary" onclick="sendChat()" style="align-self:flex-end;">ì „ì†¡</button>
        </div>
      </div>
    </aside>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // State
    let currentTool = null;
    let lastResults = null;
    let chatHistory = [];

    // Tool Selection
    function selectTool(toolId) {
      // Deselect all
      document.querySelectorAll('.tool-card').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tool-config').forEach(el => el.style.display = 'none');

      // Select new
      document.getElementById(`tool-${toolId}`).classList.add('active');
      document.getElementById(`config-${toolId}`).style.display = 'block';
      currentTool = toolId;
    }

    // Show Toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Show Loading
    function showLoading(message = 'ì²˜ë¦¬ ì¤‘...') {
      document.getElementById('results').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <span>${message}</span>
        </div>
      `;
    }

    // ===== YouTube ë¦¬ì„œì²˜ =====
    async function runYouTube() {
      const query = document.getElementById('yt-query').value.trim();
      const action = document.getElementById('yt-action').value;
      const limit = document.getElementById('yt-limit').value;

      if (!query) {
        showToast('ê²€ìƒ‰ì–´ ë˜ëŠ” URLì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      showLoading('YouTube ê²€ìƒ‰ ì¤‘...');

      try {
        const response = await fetch('/api/ai-tools/youtube', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query, action, limit: parseInt(limit) })
        });

        const data = await response.json();

        if (data.ok) {
          lastResults = data;
          renderYouTubeResults(data);
        } else {
          document.getElementById('results').innerHTML = `
            <div class="result-card">
              <div class="result-content" style="color:#ef4444;">âŒ ì˜¤ë¥˜: ${data.error}</div>
            </div>
          `;
        }
      } catch (err) {
        document.getElementById('results').innerHTML = `
          <div class="result-card">
            <div class="result-content" style="color:#ef4444;">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}</div>
          </div>
        `;
      }
    }

    function renderYouTubeResults(data) {
      let html = '';

      if (data.videos && data.videos.length > 0) {
        html += `<div class="result-card">
          <div class="result-header">
            <div class="result-title">ğŸ¬ ê²€ìƒ‰ ê²°ê³¼ (${data.videos.length}ê°œ)</div>
          </div>`;

        for (const video of data.videos) {
          html += `
            <div class="result-video">
              <img src="${video.thumbnail}" alt="${video.title}">
              <div class="result-video-info">
                <div class="result-video-title">${video.title}</div>
                <div class="result-video-channel">${video.channel} â€¢ ${video.views || ''}</div>
              </div>
              <button class="btn-small" onclick="getTranscript('${video.id}')">ìë§‰</button>
            </div>
          `;
        }

        html += `<div class="result-actions">
          <button class="btn-small" onclick="copyResults()">ğŸ“‹ ë³µì‚¬</button>
          <button class="btn-small" onclick="analyzeWithAI()">ğŸ¤– AI ë¶„ì„</button>
        </div></div>`;
      }

      if (data.transcript) {
        html += `<div class="result-card">
          <div class="result-header">
            <div class="result-title">ğŸ“ ìë§‰</div>
            <div class="result-meta">${data.video_title || ''}</div>
          </div>
          <div class="result-content">${data.transcript}</div>
          <div class="result-actions">
            <button class="btn-small" onclick="copyText(\`${data.transcript.replace(/`/g, '\\`')}\`)">ğŸ“‹ ë³µì‚¬</button>
            <button class="btn-small" onclick="summarizeTranscript()">ğŸ“ ìš”ì•½</button>
          </div>
        </div>`;
      }

      if (data.comments && data.comments.length > 0) {
        html += `<div class="result-card">
          <div class="result-header">
            <div class="result-title">ğŸ’¬ ëŒ“ê¸€ ë¶„ì„ (${data.comments.length}ê°œ)</div>
          </div>
          <div class="result-content">`;

        for (const comment of data.comments.slice(0, 10)) {
          html += `<div style="margin-bottom:0.5rem;padding:0.5rem;background:var(--bg);border-radius:6px;">
            <div style="font-size:0.75rem;color:var(--text-muted);">${comment.author} â€¢ ğŸ‘ ${comment.likes}</div>
            <div style="font-size:0.85rem;">${comment.text}</div>
          </div>`;
        }

        html += `</div>
          <div class="result-actions">
            <button class="btn-small" onclick="analyzeComments()">ğŸ” ê°ì • ë¶„ì„</button>
          </div>
        </div>`;
      }

      document.getElementById('results').innerHTML = html || '<div class="empty-state">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    }

    async function getTranscript(videoId) {
      showLoading('ìë§‰ ì¶”ì¶œ ì¤‘...');

      try {
        const response = await fetch('/api/ai-tools/youtube', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: videoId, action: 'transcript' })
        });

        const data = await response.json();
        if (data.ok) {
          lastResults = data;
          renderYouTubeResults(data);
        } else {
          showToast('ìë§‰ ì¶”ì¶œ ì‹¤íŒ¨: ' + data.error);
        }
      } catch (err) {
        showToast('ì˜¤ë¥˜: ' + err.message);
      }
    }

    // ===== íŠ¸ë Œë“œ ìŠ¤ìºë„ˆ =====
    async function runTrend() {
      const source = document.getElementById('trend-source').value;
      const category = document.getElementById('trend-category').value;
      const keyword = document.getElementById('trend-keyword').value.trim();

      showLoading('íŠ¸ë Œë“œ ìŠ¤ìº” ì¤‘...');

      try {
        const response = await fetch('/api/ai-tools/trend', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ source, category, keyword })
        });

        const data = await response.json();

        if (data.ok) {
          lastResults = data;
          renderTrendResults(data);
        } else {
          document.getElementById('results').innerHTML = `
            <div class="result-card">
              <div class="result-content" style="color:#ef4444;">âŒ ì˜¤ë¥˜: ${data.error}</div>
            </div>
          `;
        }
      } catch (err) {
        document.getElementById('results').innerHTML = `
          <div class="result-card">
            <div class="result-content" style="color:#ef4444;">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}</div>
          </div>
        `;
      }
    }

    function renderTrendResults(data) {
      let html = '';

      if (data.news && data.news.length > 0) {
        html += `<div class="result-card">
          <div class="result-header">
            <div class="result-title">ğŸ“° ë‰´ìŠ¤ íŠ¸ë Œë“œ (${data.news.length}ê°œ)</div>
            <div class="result-meta">${new Date().toLocaleString('ko-KR')}</div>
          </div>`;

        for (const item of data.news) {
          html += `
            <div style="padding:0.75rem;background:var(--bg);border-radius:8px;margin-bottom:0.5rem;">
              <div style="font-weight:500;margin-bottom:0.25rem;">${item.title}</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">${item.source} â€¢ ${item.time || ''}</div>
              ${item.summary ? `<div style="font-size:0.85rem;margin-top:0.5rem;">${item.summary}</div>` : ''}
            </div>
          `;
        }

        html += `<div class="result-actions">
          <button class="btn-small" onclick="copyResults()">ğŸ“‹ ë³µì‚¬</button>
          <button class="btn-small" onclick="generateContentIdeas()">ğŸ’¡ ì½˜í…ì¸  ì•„ì´ë””ì–´</button>
        </div></div>`;
      }

      if (data.trends && data.trends.length > 0) {
        html += `<div class="result-card">
          <div class="result-header">
            <div class="result-title">ğŸ”¥ ì¸ê¸° í‚¤ì›Œë“œ</div>
          </div>
          <div style="display:flex;flex-wrap:wrap;gap:0.5rem;">`;

        for (const trend of data.trends) {
          html += `<span style="padding:0.5rem 1rem;background:var(--bg);border-radius:20px;font-size:0.85rem;">
            ${trend.keyword} <span style="color:var(--text-muted);font-size:0.75rem;">${trend.volume || ''}</span>
          </span>`;
        }

        html += `</div></div>`;
      }

      document.getElementById('results').innerHTML = html || '<div class="empty-state">íŠ¸ë Œë“œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    }

    // ===== ì´ë¯¸ì§€ ìƒì„±ê¸° =====
    async function runImageGen() {
      const prompt = document.getElementById('img-prompt').value.trim();
      const style = document.getElementById('img-style').value;
      const ratio = document.getElementById('img-ratio').value;

      if (!prompt) {
        showToast('ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      showLoading('ì´ë¯¸ì§€ ìƒì„± ì¤‘... (ì•½ 10-30ì´ˆ ì†Œìš”)');

      try {
        const response = await fetch('/api/ai-tools/image-generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, style, ratio })
        });

        const data = await response.json();

        if (data.ok) {
          lastResults = data;
          renderImageResults(data);
        } else {
          document.getElementById('results').innerHTML = `
            <div class="result-card">
              <div class="result-content" style="color:#ef4444;">âŒ ìƒì„± ì‹¤íŒ¨: ${data.error}</div>
            </div>
          `;
        }
      } catch (err) {
        document.getElementById('results').innerHTML = `
          <div class="result-card">
            <div class="result-content" style="color:#ef4444;">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}</div>
          </div>
        `;
      }
    }

    function renderImageResults(data) {
      let html = `<div class="result-card">
        <div class="result-header">
          <div class="result-title">ğŸ¨ ìƒì„±ëœ ì´ë¯¸ì§€</div>
        </div>
        <img src="${data.image_url}" class="result-image" alt="Generated Image">
        <div style="margin-top:0.75rem;padding:0.75rem;background:var(--bg);border-radius:8px;font-size:0.85rem;">
          <strong>ì‚¬ìš©ëœ í”„ë¡¬í”„íŠ¸:</strong><br>${data.prompt_used || data.prompt}
        </div>
        <div class="result-actions">
          <button class="btn-small" onclick="window.open('${data.image_url}', '_blank')">ğŸ”— ì›ë³¸ ë³´ê¸°</button>
          <button class="btn-small" onclick="copyText('${data.prompt_used || data.prompt}')">ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
          <button class="btn-small" onclick="regenerateImage()">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
        </div>
      </div>`;

      document.getElementById('results').innerHTML = html;
    }

    // ===== ì´ë¯¸ì§€ ë¶„ì„ê¸° =====
    async function runVision() {
      const url = document.getElementById('vision-url').value.trim();
      const file = document.getElementById('vision-file').files[0];
      const prompt = document.getElementById('vision-prompt').value.trim();

      if (!url && !file) {
        showToast('ì´ë¯¸ì§€ URL ë˜ëŠ” íŒŒì¼ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }

      showLoading('ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...');

      try {
        let response;

        if (file) {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('prompt', prompt || 'ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.');

          response = await fetch('/api/ai-tools/vision', {
            method: 'POST',
            body: formData
          });
        } else {
          response = await fetch('/api/ai-tools/vision', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url, prompt: prompt || 'ì´ ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.' })
          });
        }

        const data = await response.json();

        if (data.ok) {
          lastResults = data;
          renderVisionResults(data);
        } else {
          document.getElementById('results').innerHTML = `
            <div class="result-card">
              <div class="result-content" style="color:#ef4444;">âŒ ë¶„ì„ ì‹¤íŒ¨: ${data.error}</div>
            </div>
          `;
        }
      } catch (err) {
        document.getElementById('results').innerHTML = `
          <div class="result-card">
            <div class="result-content" style="color:#ef4444;">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}</div>
          </div>
        `;
      }
    }

    function renderVisionResults(data) {
      let html = `<div class="result-card">
        <div class="result-header">
          <div class="result-title">ğŸ”¬ ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼</div>
        </div>
        ${data.image_url ? `<img src="${data.image_url}" class="result-image" style="max-height:300px;object-fit:contain;">` : ''}
        <div class="result-content" style="margin-top:1rem;">${data.analysis}</div>
        <div class="result-actions">
          <button class="btn-small" onclick="copyText(\`${data.analysis.replace(/`/g, '\\`')}\`)">ğŸ“‹ ë³µì‚¬</button>
          <button class="btn-small" onclick="askMoreAboutImage()">â“ ì¶”ê°€ ì§ˆë¬¸</button>
        </div>
      </div>`;

      document.getElementById('results').innerHTML = html;
    }

    // ===== ìœ í‹¸ë¦¬í‹° =====
    function copyResults() {
      if (!lastResults) return;
      const text = JSON.stringify(lastResults, null, 2);
      navigator.clipboard.writeText(text);
      showToast('ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
    }

    function copyText(text) {
      navigator.clipboard.writeText(text);
      showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
    }

    // ===== ì±„íŒ… ê¸°ëŠ¥ =====
    async function sendChat() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;

      // Add user message
      addChatMessage('user', message);
      input.value = '';

      // Prepare context
      const context = lastResults ? JSON.stringify(lastResults).slice(0, 3000) : '';

      try {
        const response = await fetch('/api/ai-tools/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message,
            context,
            history: chatHistory.slice(-10)
          })
        });

        const data = await response.json();

        if (data.ok) {
          addChatMessage('assistant', data.response);
        } else {
          addChatMessage('assistant', 'ì˜¤ë¥˜: ' + data.error);
        }
      } catch (err) {
        addChatMessage('assistant', 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + err.message);
      }
    }

    function addChatMessage(role, content) {
      const container = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = `chat-message ${role}`;
      div.innerHTML = `
        <div class="chat-sender">${role === 'user' ? 'You' : 'Assistant'}</div>
        <div class="chat-bubble">${content}</div>
      `;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;

      chatHistory.push({ role, content });
    }

    // AI ë¶„ì„ í•¨ìˆ˜ë“¤
    async function analyzeWithAI() {
      if (!lastResults) return;
      document.getElementById('chatInput').value = 'ì´ ê²€ìƒ‰ ê²°ê³¼ë“¤ì„ ë¶„ì„í•´ì„œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì•Œë ¤ì¤˜';
      sendChat();
    }

    async function summarizeTranscript() {
      if (!lastResults || !lastResults.transcript) return;
      document.getElementById('chatInput').value = 'ì´ ìë§‰ ë‚´ìš©ì„ ìš”ì•½í•´ì¤˜';
      sendChat();
    }

    async function analyzeComments() {
      if (!lastResults || !lastResults.comments) return;
      document.getElementById('chatInput').value = 'ì´ ëŒ“ê¸€ë“¤ì˜ ì „ë°˜ì ì¸ ë°˜ì‘ê³¼ ê°ì •ì„ ë¶„ì„í•´ì¤˜';
      sendChat();
    }

    async function generateContentIdeas() {
      if (!lastResults) return;
      document.getElementById('chatInput').value = 'ì´ íŠ¸ë Œë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ YouTube ì½˜í…ì¸  ì•„ì´ë””ì–´ 5ê°œ ì œì•ˆí•´ì¤˜';
      sendChat();
    }

    function regenerateImage() {
      runImageGen();
    }

    function askMoreAboutImage() {
      const question = prompt('ì´ë¯¸ì§€ì— ëŒ€í•´ ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì„¸ìš”?');
      if (question) {
        document.getElementById('chatInput').value = question;
        sendChat();
      }
    }

    // Enter to send chat
    document.getElementById('chatInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendChat();
      }
    });
  </script>

</body>
</html>
